# Режими на работа

### Режим 1: Ползване на резервоара `MODE_USE_TANK`

Хидрофорната помпа черпи вода от резервоара и подава към сградата. Сондажът продължава да пълни резервоара на самотек, докато той не се напълни.

##### Условия за активиране:
- Нивото на резервоара е над минималното.

##### Условия за деактивиране:
- Нивото на резервоара пада под минималното, което води до преминаване към Режим 2.
  
<img src="/diagrams/mode_use_tank.svg" alt="Alt text" style="width: 400px;" />


##### Активни клапани:

- **2 `valve_spring_to_tank`** Отворен, ако `tank_high_level` е false.
- **6 `valve_tank_to_pump`** Отворен за подаване на вода от резервоара към хидрофорната помпа.
- **7 `valve_pump_to_building`** Отворен за подаване на вода към сградата.

##### Неактивни клапани:

- **1 `valve_supply_to_tank`** Затворен, за да предотврати пълненето на резервоара от водопровода.
- **3 `valve_pump_to_tank`** Затворен, за да предотврати връщането на вода от помпата към резервоара.
- **4 `valve_supply_to_pump`** Затворен, за да не подава вода директно от водопровода към помпата.
- **5 `valve_spring_to_pump`** Затворен, защото помпата черпи вода от резервоара.

---

### Режим 2: Ползване на водопровода `MODE_USE_SUPPLY`

Вода от водопровода (ВиК) се подава директно към сградата, докато резервоарът се пълни от сондажа.

##### Условия за активиране:
- Нивото на резервоара е под минималното.
- Налягането във водопровода е достатъчно.

##### Условия за деактивиране:
- Резервоарът се е напълнил, което води до преминаване към Режим 1.
- Налягането във водопровода спада, което води до преминаване към Режим 3.
  
<img src="/diagrams/mode_use_supply.svg" alt="Alt text" style="width: 400px;" />

##### Активни клапани:

- **2 `valve_spring_to_tank`** Отворен за продължаване на пълненето на резервоара от сондажа.
- **4 `valve_supply_to_pump`** Отворен за подаване на вода към помпата.
- **7 `valve_pump_to_building`** Отворен за подаване на вода към сградата.

##### Неактивни клапани:

- **1 `valve_supply_to_tank`** Затворен, защото резервоарът не се пълни от водопровода.
- **3 `valve_pump_to_tank`** Затворен за предотвратяване на връщане на вода от помпата.
- **5 `valve_spring_to_pump`** Затворен, защото водата се подава от водопровода.
- **6 `valve_tank_to_pump`** Затворен, защото резервоарът не подава вода към помпата.



---

### Режим 3: Захранване чрез смучене `MODE_MIXED_SUPPLY`

Вода се черпи едновременно от водопровода и сондажа при активна консумация в сградата, ако резервоарът е с ниско ниво и няма достатъчно налягане във водопровода.

##### Условия за активиране:
- Нивото на резервоара е под минималното.
- Налягането във водопровода е недостатъчно.
- Има активна консумация в сградата.

##### Условия за деактивиране:
- Консумацията на вода спира, което води до преминаване към Режим 4.
- Налягането във водопровода се възстановява, което води до връщане към Режим 2.

<img src="/diagrams/mode_mixed_supply.svg" alt="Alt text" style="width: 400px;" />

##### Активни клапани:

- **4 `valve_supply_to_pump`**: Отворен, за да подаде вода от водопровода към помпата.
- **5 `valve_spring_to_pump`** Отворен, за да подаде вода от сондажа към помпата.
- **7 `valve_pump_to_building`** Отворен за подаване на вода към сградата.

##### Неактивни клапани:

- **1 `valve_supply_to_tank`** Затворен, за да не пълни резервоара от водопровода.
- **2 `valve_spring_to_tank`** Затворен, защото водата се подава директно към помпата.
- **3 `valve_pump_to_tank`** Затворен, за да не връща вода от помпата към резервоара.
- **6 `valve_tank_to_pump`** Затворен, защото резервоарът не подава вода към помпата.

---

#### Режим 4: Пълнене на резервоара чрез смучене `MODE_FILL_TANK`

Помпата черпи вода едновременно от водопровода и сондажа и връща водата в резервоара.

##### Условия за активиране:
- Нивото на резервоара е под минималното.
- Налягането във водопровода е недостатъчно.
- Няма активна консумация в сградата.

##### Условия за деактивиране:
- Резервоарът се е напълнил, което води до преминаване към Режим 1 или Режим 2.
- Налягането във водопровода се възстановява, което води до връщане към Режим 2.

<img src="/diagrams/mode_fill_tank.svg" alt="Alt text" style="width: 400px;" />

##### Активни клапани:

- **4 `valve_supply_to_pump`** Отворен за подаване на вода към помпата.
- **5 `valve_spring_to_pump`** Отворен за подаване на вода от сондажа.
- **3 `valve_pump_to_tank`** Отворен за връщане на вода към резервоара.

##### Неактивни клапани:

- **1 `valve_supply_to_tank`** Затворен.
- **2 `valve_spring_to_tank`** Затворен.
- **6 `valve_tank_to_pump`** Затворен.
- **Клапан 7 `valve_pump_to_building`** Затворен, защото няма консумация.
