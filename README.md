# Интелигентна система за управление на водоснабдяване

Проектът представлява система за управление на водоснабдяването на сграда, използвайки два водоизточника - сондажен източник (кладенец) и водопровод (ВиК), с резервоар за съхранение на вода. Системата автоматично избира и превключва между различни режими на работа в зависимост от наличието на вода в резервоара, налягането във водопровода и потреблението на вода в сградата. Основната цел е ефективно управление на водата, като се осигури непрекъснато водоснабдяване на сградата.

## Основни компоненти:

1. **Резервоар**: Съхранява вода, която може да бъде използвана за захранване на сградата. Пълни се от сондажа или водопровода в зависимост от режима.
2. **Хидрофорна помпа**: Използва се за подаване на вода от различни източници към сградата.
3. **Сондаж (Изворен източник)**: Подава вода към резервоара или директно към помпата, в зависимост от режима на работа.
4. **Водопровод (ВиК)**: Основен източник на вода, когато резервоарът е празен или налягането във водопровода е достатъчно.

## Сензори:

Системата разполага с различни сензори, които следят ключови параметри като нивото на водата в резервоара, налягането във водопровода и потреблението на вода в сградата. Тези сензори осигуряват обратна връзка към системата, позволявайки ѝ автоматично да променя режимите на работа според моментната ситуация, с цел оптимизация и надеждност на водоснабдяването.

## Клапани:

Системата включва набор от клапани, които контролират потока на водата между водопровода, резервоара, помпата и сградата. Клапаните се активират и деактивират в зависимост от текущия режим на работа.

## Режими на работа:

1. **Ползване на резервоара (MODE_USE_TANK)**: Помпата черпи вода от резервоара и подава към сградата. Сондажът пълни резервоара на самотек.
2. **Ползване на водопровода (MODE_USE_SUPPLY)**: Вода от водопровода подава директно към сградата, докато резервоарът се пълни от сондажа.
3. **Смучене и подаване към сградата (MODE_MIXED_SUPPLY)**: Ако налягането във водопровода е недостатъчно, системата черпи едновременно вода от сондажа и водопровода.
4. **Пълнене на резервоара със смучене (MODE_FILL_TANK)**: Помпата черпи вода едновременно от водопровода и сондажа и връща водата в резервоара.

## Автоматизация:

Системата автоматично преминава между режимите на базата на състоянието на сензорите. При ниско ниво на резервоара или при недостатъчно налягане във водопровода, системата избира най-подходящия режим за осигуряване на непрекъснато водоснабдяване на сградата.

---

## Режим 1: Ползване на резервоара (MODE_USE_TANK)

Хидрофорната помпа черпи вода от резервоара и подава към сградата. Сондажът продължава да пълни резервоара на самотек, докато той не се напълни.

**Причина за включване:**
- Нивото на резервоара е над минималното.

**Причина за изключване:**
- Нивото на резервоара пада под минималното, което води до преминаване към Режим 2.

### Активни клапани:

- **Клапан 2 (spring to tank):** Отворен, ако `tank_high_level` е false (резервоарът не е пълен). Затворен, ако `tank_high_level` е true (резервоарът е пълен).
- **Клапан 6 (tank to pump):** Отворен, за да подаде вода от резервоара към хидрофорната помпа.
- **Клапан 7 (pump to building):** Отворен, за да подаде вода от помпата към сградата.

### Неактивни клапани:

- **Клапан 1 (supply to tank):** Затворен, за да предотврати пълненето на резервоара от водопровода.
- **Клапан 3 (pump to tank):** Затворен, за да предотврати връщането на вода от помпата към резервоара.
- **Клапан 4 (supply to pump):** Затворен, за да не подава вода от водопровода директно към помпата.
- **Клапан 5 (spring to pump):** Затворен, защото в този режим помпата черпи вода от резервоара, а не директно от сондажа.

---

## Режим 2: Ползване на водопровода (MODE_USE_SUPPLY)

Вода от водопровода (ВиК) се подава директно към сградата, докато резервоарът се пълни от сондажа.

**Причина за включване:**
- Нивото на резервоара е под минималното.
- Налягането във водопровода е достатъчно.

**Причина за изключване:**
- Резервоарът се е напълнил, което води до преминаване към Режим 1.
- Налягането във водопровода спада, което води до преминаване към Режим 3.

### Активни клапани:

- **Клапан 2 (spring to tank):** Отворен, за да продължи пълненето на резервоара от сондажа.
- **Клапан 4 (supply to pump):** Отворен, за да подаде вода от водопровода към хидрофорната помпа.
- **Клапан 7 (pump to building):** Отворен, за да подаде вода от помпата към сградата.

### Неактивни клапани:

- **Клапан 1 (supply to tank):** Затворен, защото резервоарът не се пълни от водопровода.
- **Клапан 3 (pump to tank):** Затворен, за да не връща вода от помпата обратно към резервоара.
- **Клапан 5 (spring to pump):** Затворен, защото водоподаването се извършва от водопровода, а не от сондажа директно към помпата.
- **Клапан 6 (tank to pump):** Затворен, защото резервоарът не подава вода към помпата в този режим.

---

## Режим 3: Захранване чрез смучене (MODE_MIXED_SUPPLY)

Вода се черпи едновременно от водопровода (ВиК) и сондажа при активна консумация в сградата, ако резервоарът е с ниско ниво и няма достатъчно налягане във водопровода.

**Причина за включване:**
- Нивото на резервоара е под минималното.
- Налягането във водопровода е недостатъчно.
- Има активна консумация в сградата.

**Причина за изключване:**
- Консумацията на вода в сградата спира, което води до преминаване към Режим 4 за пълнене на резервоара.
- Налягането във водопровода се възстановява, което води до автоматично връщане към Режим 2.

### Активни клапани:

- **Клапан 4 (supply to pump):** Отворен, за да подаде вода от водопровода към хидрофорната помпа.
- **Клапан 5 (spring to pump):** Отворен, за да подаде вода от сондажа директно към помпата.
- **Клапан 7 (pump to building):** Отворен, за да подаде вода към сградата.

### Неактивни клапани:

- **Клапан 1 (supply to tank):** Затворен, за да не пълни резервоара от водопровода.
- **Клапан 2 (spring to tank):** Затворен, защото водата от сондажа се подава директно към помпата, а не към резервоара.
- **Клапан 3 (pump to tank):** Затворен, за да не връща вода от помпата обратно към резервоара.
- **Клапан 6 (tank to pump):** Затворен, защото резервоарът не подава вода към помпата в този режим.

---

## Режим 4: Пълнене на резервоара чрез смучене (MODE_FILL_TANK)

Помпата черпи вода едновременно от водопровода и сондажа и връща водата в резервоара.

**Причина за включване:**
- Нивото на резервоара е под минималното.
- Налягането във водопровода е недостатъчно.
- Няма активна консумация в сградата.

**Причина за изключване:**
- Резервоарът се е напълнил, което води до преминаване към Режим 1 или Режим 2, в зависимост от състоянието на водопровода и консумацията в сградата.
- Налягането във водопровода се възстановява, което води до преминаване към Режим 2.

### Активни клапани:

- **Клапан 4 (supply to pump):** Отворен, за да подаде вода от водопровода към хидрофорната помпа. Водата от водопровода минава през помпата.
- **Клапан 5 (spring to pump):** Отворен, за да подаде вода от сондажа директно към помпата. Водата от сондажа също се движи през помпата.
- **Клапан 3 (pump to tank):** Отворен, за да върне вода от помпата в резервоара. Помпата връща водата обратно в резервоара след смучене от водопровода и сондажа.

### Неактивни клапани:

- **Клапан 1 (supply to tank):** Затворен, защото водопроводът подава вода към помпата, а не директно към резервоара.
- **Клапан 2 (spring to tank):** Затворен, защото водата от сондажа се движи към помпата, а не директно към резервоара.
- **Клапан 6 (tank to pump):** Затворен, защото резервоарът се пълни, а не подава вода към помпата.
- **Клапан 7 (pump to building):** Затворен, защото няма активна консумация в сградата в този режим, водата се връща в резервоара.

---

## Сензори:

1. **Сензор за високо ниво в резервоара**
   - ID: `tank_high_level`
   - Следи дали резервоарът е пълен.
   
2. **Сензор за ниско ниво в резервоара**
   - ID: `tank_low_level`
   - Следи дали нивото в резервоара е под минималното.
   
3. **Сензор за наличие на вода във водопровода (ВиК)**
   - ID: `water_supply_available`
   - Следи дали има достатъчно налягане във водопровода.
   
4. **Сензор за консумация на вода в сградата**
   - ID: `building_water_consumption`
   - Следи дали има активна консумация на вода в сградата.

---

## Клапани:

1. **Клапан водоснабдяване към резервоара**
   - ID: `valve_supply_to_tank`
   - Управлява пълненето на резервоара от водопровода.
   
2. **Клапан сондаж към резервоара**
   - ID: `valve_spring_to_tank`
   - Управлява пълненето на резервоара от сондажа.
   
3. **Клапан помпа към резервоара**
   - ID: `valve_pump_to_tank`
   - Управлява връщането на вода от помпата към резервоара.
   
4. **Клапан водоснабдяване към помпата**
   - ID: `valve_supply_to_pump`
   - Управлява подаването на вода от водопровода към помпата.
   
5. **Клапан сондаж към помпата**
   - ID: `valve_spring_to_pump`
   - Управлява подаването на вода от сондажа директно към помпата.
   
6. **Клапан резервоар към помпата**
   - ID: `valve_tank_to_pump`
   - Управлява подаването на вода от резервоара към помпата.
   
7. **Клапан помпа към сградата**
   - ID: `valve_pump_to_building`
   - Управлява подаването на вода от помпата към сградата.
